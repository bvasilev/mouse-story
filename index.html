<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>
    <script src="levels.js"></script>
    <script src="model.js"></script>
</head>
<body>

    <script>

    var model = new Model();

    model.readLevelFromFile(5)

    //var level=[[".",".","."],["#",".","."],["#",".","."]]
    var actors=[]

    var squaresize=100

    var gridX=model._grid.length//model.cntCols//level[0].length
    var gridY=gridX//model.cntRows//level.length

    var width = window.innerWidth-20
    var height = window.innerHeight-20

    var config = {
        type: Phaser.AUTO,
        width: width,
        height: height,
        physics: {
            default: 'arcade',
            arcade: {
                gravity: {  },
                debug: false
            }
        },
        scene: {
            preload: preload,
            create: display_model,
            update: update
        }
    };

    var game = new Phaser.Game(config);

    function preload ()
    {
    
        this.load.image('Normal Mouse', 'assets/img/mouse.png');
        this.load.image('Free Tile', 'assets/img/panel.png');
        this.load.image('Obstacle Tile', 'assets/img/obstacle.png');
        this.load.image('Cheese', 'assets/img/cheese.png');
        this.load.image('Blue Mouse', 'assets/img/blue-mouse.png');
        this.load.image('Blue Cheese', 'assets/img/blue-cheese.png');
        this.load.image('Normal House', 'assets/img/house.png');
        this.load.image('Blue House', 'assets/img/house.png');
    }

    function display_model ()
    {
        var x=height/(1200*gridY);
        var y=width/(1200*gridX);
        if(y<x) x=y
        squaresize=800*x


        for (var i = gridX-1; i >= 0; i--) {
            for (var j = gridY-1; j >= 0; j--) {
                var squareType = model.queryTile(gridY-j-1,gridX-i-1).phaserTextureAlias
                var panel = this.add.image(0, 0, squareType).setScale(x,x).setOrigin(i-gridX+1,j-gridY-(height-200)/800);
            }   
        }

        for(var a of model.actors){
            var actor=this.add.sprite(0,0,model.actors[0].name).setOrigin(0,-1-(height-200)/800);
            actor.displayHeight=x*800;
            actor.displayWidth=x*800;
            actor.z=-100000;
            actors[i]=[actor,a.x,a.y];
            i+=1
        }
    }

    function update()
    {
        do{
            setTimeout(function(){},1000);
            display_model()
        } while(model.runStep())
    }
    </script>

</body>
</html>